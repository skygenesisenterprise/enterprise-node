{"version":3,"file":"loader.js","sourceRoot":"","sources":["loader.ts"],"names":[],"mappings":"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","sourcesContent":["import { EnterpriseConfig, FrameworkType, ModuleInterface } from '../types';\nimport { WasmRuntime } from './runtime';\n\nexport class ModuleLoader {\n  private config: EnterpriseConfig;\n  private runtime: WasmRuntime;\n  private loadedModules: Map<string, ModuleInterface> = new Map();\n  private framework: FrameworkType;\n\n  constructor(config: EnterpriseConfig) {\n    this.config = config;\n    this.runtime = new WasmRuntime();\n    this.framework = this.detectFramework();\n  }\n\n  async initialize(): Promise<void> {\n    if (this.config.runtime?.enableWasm !== false) {\n      await this.runtime.initialize();\n    }\n\n    const modulePromises: Promise<void>[] = [];\n\n    if (this.config.modules.ai) {\n      modulePromises.push(this.loadModule('ai', () => import('../modules/ai')));\n    }\n    if (this.config.modules.storage) {\n      modulePromises.push(this.loadModule('storage', () => import('../modules/storage')));\n    }\n    if (this.config.modules.ui) {\n      modulePromises.push(this.loadModule('ui', () => import('../modules/ui')));\n    }\n    if (this.config.modules.project) {\n      modulePromises.push(this.loadModule('project', () => import('../modules/project')));\n    }\n    if (this.config.modules.auth) {\n      modulePromises.push(this.loadModule('auth', () => import('../modules/auth')));\n    }\n    if (this.config.modules.sdk) {\n      modulePromises.push(this.loadModule('sdk', () => import('../modules/sdk')));\n    }\n\n    await Promise.all(modulePromises);\n\n    if (this.config.debug) {\n      console.log(`Enterprise SDK initialized with framework: ${this.framework}`);\n      console.log(`Loaded modules: ${Array.from(this.loadedModules.keys()).join(', ')}`);\n    }\n  }\n\n  private async loadModule(name: string, importFn: () => Promise<any>): Promise<void> {\n    try {\n      const moduleExports = await importFn();\n      const ModuleClass =\n        moduleExports.default || moduleExports[name.charAt(0).toUpperCase() + name.slice(1)];\n\n      if (ModuleClass && typeof ModuleClass === 'function') {\n        const moduleInstance = new ModuleClass(this.runtime);\n        await moduleInstance.init();\n        this.loadedModules.set(name, moduleInstance);\n      }\n    } catch (error) {\n      console.error(`Failed to load module '${name}':`, error);\n    }\n  }\n\n  private detectFramework(): FrameworkType {\n    if (this.config.framework && this.config.framework !== 'auto') {\n      return this.config.framework as FrameworkType;\n    }\n\n    if (typeof window !== 'undefined') {\n      if ((window as any).__NEXT_DATA__) {\n        return 'nextjs';\n      }\n      if ((window as any).React || (window as any).ReactDOM) {\n        return 'react';\n      }\n      if ((window as any).SvelteComponent) {\n        return 'svelte';\n      }\n    }\n\n    if (typeof process !== 'undefined' && process.versions?.node) {\n      return 'vanilla';\n    }\n\n    return 'vanilla';\n  }\n\n  getModule(name: string): ModuleInterface | undefined {\n    return this.loadedModules.get(name);\n  }\n\n  getRuntime(): WasmRuntime {\n    return this.runtime;\n  }\n\n  getFramework(): FrameworkType {\n    return this.framework;\n  }\n\n  async destroy(): Promise<void> {\n    for (const [name, module] of this.loadedModules) {\n      try {\n        await module.destroy();\n      } catch (error) {\n        console.error(`Error destroying module '${name}':`, error);\n      }\n    }\n    this.loadedModules.clear();\n    this.runtime.destroy();\n  }\n}\n"]}