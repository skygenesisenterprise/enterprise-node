{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from './logger';\nimport { Tracer, Span } from './tracer';\nimport { Subscriber } from './types';\nimport { LogLevel } from './types';\n\nexport class DebugModule {\n  private static instance: DebugModule;\n  private tracer: Tracer;\n  private loggers: Map<string, Logger> = new Map();\n  private globalSubscribers: Subscriber[] = [];\n\n  private constructor() {\n    this.tracer = new Tracer();\n  }\n\n  static getInstance(): DebugModule {\n    if (!DebugModule.instance) {\n      DebugModule.instance = new DebugModule();\n    }\n    return DebugModule.instance;\n  }\n\n  getLogger(target: string = 'default'): Logger {\n    if (!this.loggers.has(target)) {\n      const logger = new Logger({ target });\n      this.globalSubscribers.forEach((subscriber) => logger.subscribe(subscriber));\n      this.loggers.set(target, logger);\n    }\n    return this.loggers.get(target)!;\n  }\n\n  getTracer(): Tracer {\n    return this.tracer;\n  }\n\n  subscribe(subscriber: Subscriber): void {\n    this.globalSubscribers.push(subscriber);\n    this.tracer.subscribe(subscriber);\n    this.loggers.forEach((logger) => logger.subscribe(subscriber));\n  }\n\n  unsubscribe(subscriber: Subscriber): void {\n    const index = this.globalSubscribers.indexOf(subscriber);\n    if (index > -1) {\n      this.globalSubscribers.splice(index, 1);\n    }\n    this.tracer.unsubscribe(subscriber);\n    this.loggers.forEach((logger) => logger.unsubscribe(subscriber));\n  }\n\n  setGlobalLevel(level: LogLevel): void {\n    this.loggers.forEach((logger) => logger.setLevel(level));\n  }\n\n  enableDebugMode(): void {\n    this.setGlobalLevel(LogLevel.DEBUG);\n  }\n\n  enableTraceMode(): void {\n    this.setGlobalLevel(LogLevel.TRACE);\n  }\n\n  disableDebugMode(): void {\n    this.setGlobalLevel(LogLevel.INFO);\n  }\n\n  instrument<T>(\n    name: string,\n    fn: (span: Span) => T,\n    target: string = 'default',\n    metadata?: Record<string, any>\n  ): T {\n    const logger = this.getLogger(target);\n    const span = this.tracer.startSpan(name, this.tracer.getCurrentSpan(), metadata);\n    const spanLogger = logger.withSpan(span.toContext());\n\n    spanLogger.debug(`Starting ${name}`, metadata);\n\n    try {\n      const result = fn(span);\n      spanLogger.debug(`Completed ${name}`, { duration: span.getDuration() });\n      return result;\n    } catch (error) {\n      spanLogger.error(`Error in ${name}`, {\n        error: error instanceof Error ? error.message : String(error),\n        duration: span.getDuration(),\n      });\n      throw error;\n    } finally {\n      span.end();\n    }\n  }\n\n  async instrumentAsync<T>(\n    name: string,\n    fn: (span: Span) => Promise<T>,\n    target: string = 'default',\n    metadata?: Record<string, any>\n  ): Promise<T> {\n    const logger = this.getLogger(target);\n    const span = this.tracer.startSpan(name, this.tracer.getCurrentSpan(), metadata);\n    const spanLogger = logger.withSpan(span.toContext());\n\n    spanLogger.debug(`Starting ${name}`, metadata);\n\n    try {\n      const result = await fn(span);\n      spanLogger.debug(`Completed ${name}`, { duration: span.getDuration() });\n      return result;\n    } catch (error) {\n      spanLogger.error(`Error in ${name}`, {\n        error: error instanceof Error ? error.message : String(error),\n        duration: span.getDuration(),\n      });\n      throw error;\n    } finally {\n      span.end();\n    }\n  }\n\n  shutdown(): void {\n    this.tracer.finishAll();\n  }\n}\n\nexport const debug = DebugModule.getInstance();\n\nexport function createDebugLogger(target: string): Logger {\n  return debug.getLogger(target);\n}\n\nexport function createTracer(): Tracer {\n  return debug.getTracer();\n}\n\nexport function instrument<T>(\n  name: string,\n  fn: (span: Span) => T,\n  target?: string,\n  metadata?: Record<string, any>\n): T {\n  return debug.instrument(name, fn, target, metadata);\n}\n\nexport async function instrumentAsync<T>(\n  name: string,\n  fn: (span: Span) => Promise<T>,\n  target?: string,\n  metadata?: Record<string, any>\n): Promise<T> {\n  return debug.instrumentAsync(name, fn, target, metadata);\n}\n\nexport const trace = (target: string = 'default') =>\n  debug.getLogger(target).trace.bind(debug.getLogger(target));\nexport const debug_log = (target: string = 'default') =>\n  debug.getLogger(target).debug.bind(debug.getLogger(target));\nexport const info = (target: string = 'default') =>\n  debug.getLogger(target).info.bind(debug.getLogger(target));\nexport const warn = (target: string = 'default') =>\n  debug.getLogger(target).warn.bind(debug.getLogger(target));\nexport const error = (target: string = 'default') =>\n  debug.getLogger(target).error.bind(debug.getLogger(target));\n"]}