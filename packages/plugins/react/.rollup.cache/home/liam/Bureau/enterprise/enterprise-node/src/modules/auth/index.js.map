{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import { ModuleInterface } from '../../types';\nimport { WasmRuntime } from '../../core/runtime';\n\nexport interface User {\n  id: string;\n  email: string;\n  name?: string;\n  avatar?: string;\n  roles?: string[];\n  metadata?: any;\n}\n\nexport interface AuthSession {\n  token: string;\n  user: User;\n  expiresAt: number;\n  refreshToken?: string;\n}\n\nexport class Auth implements ModuleInterface {\n  name = 'auth';\n  version = '0.1.0';\n  private runtime: WasmRuntime;\n  private currentSession: AuthSession | null = null;\n\n  constructor(runtime: WasmRuntime) {\n    this.runtime = runtime;\n  }\n\n  async init(): Promise<void> {\n    console.log('Auth Module initialized');\n    await this.restoreSession();\n  }\n\n  async destroy(): Promise<void> {\n    await this.logout();\n    console.log('Auth Module destroyed');\n  }\n\n  async login(credentials: {\n    email: string;\n    password?: string;\n    provider?: string;\n    token?: string;\n  }): Promise<{\n    user: User;\n    token: string;\n    session: AuthSession;\n  }> {\n    try {\n      const result = await this.runtime.call('auth_login', credentials);\n      \n      const user: User = {\n        id: result.user?.id || `user_${Date.now()}`,\n        email: credentials.email,\n        name: result.user?.name || credentials.email.split('@')[0],\n        avatar: result.user?.avatar,\n        roles: result.user?.roles || ['user'],\n        metadata: result.user?.metadata || {}\n      };\n\n      const session: AuthSession = {\n        token: result.token || this.generateToken(),\n        user,\n        expiresAt: Date.now() + (24 * 60 * 60 * 1000), // 24 hours\n        refreshToken: result.refreshToken\n      };\n\n      this.currentSession = session;\n      await this.saveSession(session);\n\n      return {\n        user,\n        token: session.token,\n        session\n      };\n    } catch (error) {\n      console.error('Auth login failed:', error);\n      throw new Error('Login failed');\n    }\n  }\n\n  async logout(): Promise<{\n    loggedOut: boolean;\n  }> {\n    try {\n      if (this.currentSession) {\n        await this.runtime.call('auth_logout', this.currentSession.token);\n      }\n\n      this.currentSession = null;\n      await this.clearSession();\n\n      return { loggedOut: true };\n    } catch (error) {\n      console.error('Auth logout failed:', error);\n      return { loggedOut: false };\n    }\n  }\n\n  async register(userData: {\n    email: string;\n    password?: string;\n    name?: string;\n    metadata?: any;\n  }): Promise<{\n    user: User;\n    token: string;\n    session: AuthSession;\n  }> {\n    try {\n      const result = await this.runtime.call('auth_register', userData);\n      \n      const user: User = {\n        id: result.user?.id || `user_${Date.now()}`,\n        email: userData.email,\n        name: userData.name || userData.email.split('@')[0],\n        roles: ['user'],\n        metadata: userData.metadata || {}\n      };\n\n      const session: AuthSession = {\n        token: result.token || this.generateToken(),\n        user,\n        expiresAt: Date.now() + (24 * 60 * 60 * 1000),\n        refreshToken: result.refreshToken\n      };\n\n      this.currentSession = session;\n      await this.saveSession(session);\n\n      return {\n        user,\n        token: session.token,\n        session\n      };\n    } catch (error) {\n      console.error('Auth register failed:', error);\n      throw new Error('Registration failed');\n    }\n  }\n\n  async refreshToken(): Promise<{\n    token: string;\n    session: AuthSession;\n  }> {\n    if (!this.currentSession?.refreshToken) {\n      throw new Error('No refresh token available');\n    }\n\n    try {\n      const result = await this.runtime.call('auth_refresh', this.currentSession.refreshToken);\n      \n      const session: AuthSession = {\n        ...this.currentSession,\n        token: result.token || this.generateToken(),\n        expiresAt: Date.now() + (24 * 60 * 60 * 1000),\n        refreshToken: result.refreshToken || this.currentSession.refreshToken\n      };\n\n      this.currentSession = session;\n      await this.saveSession(session);\n\n      return {\n        token: session.token,\n        session\n      };\n    } catch (error) {\n      console.error('Auth refresh failed:', error);\n      throw new Error('Token refresh failed');\n    }\n  }\n\n  getCurrentUser(): User | null {\n    return this.currentSession?.user || null;\n  }\n\n  getCurrentSession(): AuthSession | null {\n    return this.currentSession;\n  }\n\n  isAuthenticated(): boolean {\n    return this.currentSession !== null && this.currentSession.expiresAt > Date.now();\n  }\n\n  hasRole(role: string): boolean {\n    if (!this.currentSession?.user?.roles) {\n      return false;\n    }\n    return this.currentSession.user.roles.includes(role);\n  }\n\n  async updateProfile(updates: Partial<User>): Promise<{\n    user: User;\n    updated: boolean;\n  }> {\n    if (!this.currentSession) {\n      throw new Error('No active session');\n    }\n\n    try {\n      const updatedUser = { ...this.currentSession.user, ...updates };\n      const result = await this.runtime.call('auth_update_profile', updatedUser);\n\n      this.currentSession.user = updatedUser;\n      await this.saveSession(this.currentSession);\n\n      return {\n        user: updatedUser,\n        updated: result.updated !== false\n      };\n    } catch (error) {\n      console.error('Profile update failed:', error);\n      throw new Error('Profile update failed');\n    }\n  }\n\n  private generateToken(): string {\n    return btoa(`${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n  }\n\n  private async saveSession(session: AuthSession): Promise<void> {\n    try {\n      localStorage.setItem('enterprise_auth_session', JSON.stringify(session));\n    } catch (error) {\n      console.warn('Failed to save session:', error);\n    }\n  }\n\n  private async restoreSession(): Promise<void> {\n    try {\n      const stored = localStorage.getItem('enterprise_auth_session');\n      if (stored) {\n        const session: AuthSession = JSON.parse(stored);\n        if (session.expiresAt > Date.now()) {\n          this.currentSession = session;\n        } else {\n          await this.clearSession();\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to restore session:', error);\n      await this.clearSession();\n    }\n  }\n\n  private async clearSession(): Promise<void> {\n    try {\n      localStorage.removeItem('enterprise_auth_session');\n    } catch (error) {\n      console.warn('Failed to clear session:', error);\n    }\n  }\n}\n\nexport default Auth;"]}