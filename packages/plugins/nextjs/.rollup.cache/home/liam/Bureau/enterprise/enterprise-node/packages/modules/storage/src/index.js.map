{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"AAAA,oFAAoF;AACpF,4DAA4D;AAC5D,yDAAyD;AA0BzD,MAAM,OAAO,OAAO;IASlB;QARA,SAAI,GAAG,SAAS,CAAC;QACjB,YAAO,GAAG,OAAO,CAAC;QAClB,gCAAgC;QAChC,oCAAoC;QACpC,yCAAyC;QACjC,UAAK,GAAqB,IAAI,GAAG,EAAE,CAAC;QACpC,wBAAmB,GAAG,KAAK,CAAC;QAGlC,0BAA0B;QAC1B,wBAAwB;IAC1B,CAAC;IAED,KAAK,CAAC,IAAI;QACR,iEAAiE;QAEjE,IAAI,CAAC;YACH,wEAAwE;YACxE,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;YAChC,0EAA0E;QAC5E,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,kFAAkF;YAClF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,KAAK,CAAC,OAAO;QACX,+DAA+D;QAE/D,IAAI,CAAC;YACH,8CAA8C;YAC9C,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YACnB,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;YACjC,2DAA2D;QAC7D,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,8EAA8E;QAChF,CAAC;IACH,CAAC;IAED,aAAa;QACX,OAAO,IAAI,CAAC,mBAAmB,CAAC;IAClC,CAAC;IAED,KAAK,CAAC,IAAI,CACR,IAAiC,EACjC,UAA8B,EAAE;QAEhC,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,uCAAuC;QACvC,4DAA4D;QAE5D,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,YAAY,IAAI,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC;YAChF,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YAEpC,iEAAiE;YACjE,UAAU;YACV,gCAAgC;YAChC,6CAA6C;YAC7C,+CAA+C;YAC/C,oCAAoC;YACpC,eAAe;YACf,MAAM;YAEN,IAAI,OAAO,CAAC,KAAK,KAAK,KAAK,EAAE,CAAC;gBAC5B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE;oBACnB,IAAI,EAAE,IAAI;oBACV,QAAQ,EAAE,OAAO,CAAC,QAAQ;oBAC1B,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;iBACtB,CAAC,CAAC;YACL,CAAC;YAED,wDAAwD;YACxD,2DAA2D;YAC3D,UAAU;YACV,UAAU;YACV,mBAAmB;YACnB,MAAM;YAEN,OAAO;gBACL,IAAI,EAAE,IAAI;gBACV,IAAI;gBACJ,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;aAC9B,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,kEAAkE;YAClE,MAAM,IAAI,KAAK,CACb,wBAAwB,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CACnF,CAAC;QACJ,CAAC;IACH,CAAC;IAED,KAAK,CAAC,IAAI,CACR,QAAgB,EAChB,UAA8B,EAAE;QAEhC,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,uEAAuE;QAEvE,IAAI,CAAC;YACH,oBAAoB;YACpB,IAAI,OAAO,CAAC,KAAK,KAAK,KAAK,EAAE,CAAC;gBAC5B,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;gBACxC,IAAI,MAAM,EAAE,CAAC;oBACX,wEAAwE;oBACxE,OAAO;wBACL,IAAI,EAAE,MAAM,CAAC,IAAI;wBACjB,QAAQ,EAAE,MAAM,CAAC,QAAQ;qBAC1B,CAAC;gBACJ,CAAC;YACH,CAAC;YAED,qEAAqE;YACrE,uCAAuC;YACvC,oCAAoC;YACpC,8BAA8B;YAC9B,eAAe;YACf,MAAM;YAEN,yEAAyE;YAEzE,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;QACpC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,4EAA4E;YAC5E,MAAM,IAAI,KAAK,CACb,wBAAwB,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CACnF,CAAC;QACJ,CAAC;IACH,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,QAAgB;QAC3B,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,+DAA+D;QAE/D,IAAI,CAAC;YACH,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC5B,uDAAuD;YAEvD,0EAA0E;YAC1E,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,8EAA8E;YAC9E,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,UAAmB;QAG5B,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,IAAI,CAAC;YACH,qEAAqE;YAErE,4BAA4B;YAC5B,MAAM,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC;gBAC5E,IAAI;gBACJ,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC;gBACnC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC;gBACpC,SAAS,EAAE,MAAM,CAAC,SAAS;gBAC3B,UAAU,EAAE,MAAM,CAAC,SAAS;gBAC5B,QAAQ,EAAE,MAAM,CAAC,QAAQ;aAC1B,CAAC,CAAC,CAAC;YAEJ,MAAM,QAAQ,GAAG,CAAC,GAAG,WAAW,CAAC,CAAC;YAElC,OAAO;gBACL,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,CAAC;aAC5D,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,8EAA8E;YAC9E,OAAO,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QACvB,CAAC;IACH,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,QAAgB;QAC3B,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,IAAI,CAAC;YACH,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAC7B,OAAO,IAAI,CAAC;YACd,CAAC;YAED,sEAAsE;YACtE,OAAO,KAAK,CAAC;QACf,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,uFAAuF;YACvF,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAED,KAAK,CAAC,QAAQ;QAKZ,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,IAAI,CAAC;YACH,2DAA2D;YAC3D,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;gBACzE,OAAO,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC/C,CAAC,EAAE,CAAC,CAAC,CAAC;YAEN,OAAO;gBACL,UAAU,EAAE,CAAC;gBACb,SAAS,EAAE,CAAC;gBACZ,SAAS;aACV,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,0EAA0E;YAC1E,OAAO;gBACL,UAAU,EAAE,CAAC;gBACb,SAAS,EAAE,CAAC;gBACZ,SAAS,EAAE,CAAC;aACb,CAAC;QACJ,CAAC;IACH,CAAC;IAED,UAAU;QACR,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;QACnB,iDAAiD;IACnD,CAAC;IAEO,WAAW,CAAC,IAAS;QAC3B,IAAI,IAAI,YAAY,IAAI;YAAE,OAAO,IAAI,CAAC,IAAI,CAAC;QAC3C,IAAI,OAAO,IAAI,KAAK,QAAQ;YAAE,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,SAAS,CAAC;QACxE,OAAO,QAAQ,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC;IAC9B,CAAC;IAEO,WAAW,CAAC,IAAS;QAC3B,IAAI,IAAI,YAAY,IAAI;YAAE,OAAO,IAAI,CAAC,IAAI,CAAC;QAC3C,IAAI,IAAI,YAAY,WAAW;YAAE,OAAO,IAAI,CAAC,UAAU,CAAC;QACxD,IAAI,OAAO,IAAI,KAAK,QAAQ;YAAE,OAAO,IAAI,CAAC,MAAM,CAAC;QACjD,OAAO,CAAC,CAAC;IACX,CAAC;IAEO,YAAY,CAAC,IAAS;QAC5B,MAAM,OAAO,GAAG,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QACvE,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACpC,CAAC;IAEO,iBAAiB;QACvB,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC9B,MAAM,IAAI,KAAK,CAAC,oDAAoD,CAAC,CAAC;QACxE,CAAC;IACH,CAAC;CACF;AAED,MAAM,CAAC,MAAM,QAAQ,GAAG;IACtB,IAAI,EAAE,SAAS;IACf,OAAO,EAAE,OAAO;IAChB,WAAW,EAAE,6DAA6D;IAC1E,MAAM,EAAE,wBAAwB;IAChC,YAAY,EAAE,EAAE;IAChB,OAAO,EAAE;QACP,GAAG,EAAE,YAAY;KAClB;IACD,OAAO,EAAE,QAAiB;CAC3B,CAAC;AAEF,eAAe,OAAO,CAAC","sourcesContent":["// import { ModuleInterface, EnterpriseConfig } from '@skygenesisenterprise/shared';\n// import { WasmRuntime } from '@skygenesisenterprise/core';\n// import { Logger } from '@skygenesisenterprise/shared';\n\nexport interface StorageSaveOptions {\n  path?: string;\n  metadata?: any;\n  encryption?: boolean;\n  compression?: boolean;\n  cache?: boolean;\n}\n\nexport interface StorageLoadOptions {\n  decrypt?: boolean;\n  cache?: boolean;\n  version?: string;\n}\n\nexport interface StorageFileInfo {\n  path: string;\n  size: number;\n  hash: string;\n  mimeType?: string;\n  createdAt: number;\n  modifiedAt: number;\n  metadata?: any;\n}\n\nexport class Storage {\n  name = 'storage';\n  version = '0.1.0';\n  // private runtime: WasmRuntime;\n  // private config: EnterpriseConfig;\n  // private logger = Logger.getInstance();\n  private cache: Map<string, any> = new Map();\n  private isInitializedModule = false;\n\n  constructor() {\n    // this.runtime = runtime;\n    // this.config = config;\n  }\n\n  async init(): Promise<void> {\n    // this.logger.info('storage', 'Initializing Storage module...');\n\n    try {\n      // await this.runtime.call('storage_init', this.config.modules.storage);\n      this.isInitializedModule = true;\n      // this.logger.info('storage', 'Storage module initialized successfully');\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to initialize Storage module', { error });\n      throw error;\n    }\n  }\n\n  async destroy(): Promise<void> {\n    // this.logger.info('storage', 'Destroying Storage module...');\n\n    try {\n      // await this.runtime.call('storage_destroy');\n      this.cache.clear();\n      this.isInitializedModule = false;\n      // this.logger.info('storage', 'Storage module destroyed');\n    } catch (error) {\n      // this.logger.error('storage', 'Error destroying Storage module', { error });\n    }\n  }\n\n  isInitialized(): boolean {\n    return this.isInitializedModule;\n  }\n\n  async save(\n    file: File | ArrayBuffer | string,\n    options: StorageSaveOptions = {}\n  ): Promise<{ path: string; size: number; hash: string }> {\n    this.ensureInitialized();\n\n    // const startTime = performance.now();\n    // this.logger.debug('storage', 'Saving file', { options });\n\n    try {\n      const path = options.path || `/storage/${Date.now()}_${this.getFileName(file)}`;\n      const size = this.getFileSize(file);\n\n      // const result = await this.runtime.call('storage_save', file, {\n      //   path,\n      //   metadata: options.metadata,\n      //   encryption: options.encryption || false,\n      //   compression: options.compression || false,\n      //   cache: options.cache !== false,\n      //   ...options\n      // });\n\n      if (options.cache !== false) {\n        this.cache.set(path, {\n          data: file,\n          metadata: options.metadata,\n          timestamp: Date.now(),\n        });\n      }\n\n      // const processingTime = performance.now() - startTime;\n      // this.logger.info('storage', 'File saved successfully', {\n      //   path,\n      //   size,\n      //   processingTime\n      // });\n\n      return {\n        path: path,\n        size,\n        hash: this.generateHash(file),\n      };\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to save file', { error });\n      throw new Error(\n        `Storage save failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  async load(\n    filePath: string,\n    options: StorageLoadOptions = {}\n  ): Promise<{ data: any; metadata?: any }> {\n    this.ensureInitialized();\n\n    // this.logger.debug('storage', 'Loading file', { filePath, options });\n\n    try {\n      // Check cache first\n      if (options.cache !== false) {\n        const cached = this.cache.get(filePath);\n        if (cached) {\n          // this.logger.debug('storage', 'File loaded from cache', { filePath });\n          return {\n            data: cached.data,\n            metadata: cached.metadata,\n          };\n        }\n      }\n\n      // const result = await this.runtime.call('storage_load', filePath, {\n      //   decrypt: options.decrypt || false,\n      //   cache: options.cache !== false,\n      //   version: options.version,\n      //   ...options\n      // });\n\n      // this.logger.info('storage', 'File loaded successfully', { filePath });\n\n      throw new Error('File not found');\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to load file', { error, filePath });\n      throw new Error(\n        `Storage load failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  async delete(filePath: string): Promise<{ deleted: boolean }> {\n    this.ensureInitialized();\n\n    // this.logger.debug('storage', 'Deleting file', { filePath });\n\n    try {\n      this.cache.delete(filePath);\n      // await this.runtime.call('storage_delete', filePath);\n\n      // this.logger.info('storage', 'File deleted successfully', { filePath });\n      return { deleted: true };\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to delete file', { error, filePath });\n      return { deleted: false };\n    }\n  }\n\n  async list(_directory?: string): Promise<{\n    files: StorageFileInfo[];\n  }> {\n    this.ensureInitialized();\n\n    try {\n      // const result = await this.runtime.call('storage_list', directory);\n\n      // Combine with cached files\n      const cachedFiles = Array.from(this.cache.entries()).map(([path, cached]) => ({\n        path,\n        size: this.getFileSize(cached.data),\n        hash: this.generateHash(cached.data),\n        createdAt: cached.timestamp,\n        modifiedAt: cached.timestamp,\n        metadata: cached.metadata,\n      }));\n\n      const allFiles = [...cachedFiles];\n\n      return {\n        files: allFiles.sort((a, b) => b.modifiedAt - a.modifiedAt),\n      };\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to list files', { error, directory });\n      return { files: [] };\n    }\n  }\n\n  async exists(filePath: string): Promise<boolean> {\n    this.ensureInitialized();\n\n    try {\n      if (this.cache.has(filePath)) {\n        return true;\n      }\n\n      // const result = await this.runtime.call('storage_exists', filePath);\n      return false;\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to check file existence', { error, filePath });\n      return false;\n    }\n  }\n\n  async getStats(): Promise<{\n    totalFiles: number;\n    totalSize: number;\n    cacheSize: number;\n  }> {\n    this.ensureInitialized();\n\n    try {\n      // const result = await this.runtime.call('storage_stats');\n      const cacheSize = Array.from(this.cache.values()).reduce((total, cached) => {\n        return total + this.getFileSize(cached.data);\n      }, 0);\n\n      return {\n        totalFiles: 0,\n        totalSize: 0,\n        cacheSize,\n      };\n    } catch (error) {\n      // this.logger.error('storage', 'Failed to get storage stats', { error });\n      return {\n        totalFiles: 0,\n        totalSize: 0,\n        cacheSize: 0,\n      };\n    }\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n    // this.logger.debug('storage', 'Cache cleared');\n  }\n\n  private getFileName(file: any): string {\n    if (file instanceof File) return file.name;\n    if (typeof file === 'string') return file.split('/').pop() || 'unknown';\n    return `file_${Date.now()}`;\n  }\n\n  private getFileSize(file: any): number {\n    if (file instanceof File) return file.size;\n    if (file instanceof ArrayBuffer) return file.byteLength;\n    if (typeof file === 'string') return file.length;\n    return 0;\n  }\n\n  private generateHash(file: any): string {\n    const content = typeof file === 'string' ? file : JSON.stringify(file);\n    return btoa(content).slice(0, 16);\n  }\n\n  private ensureInitialized(): void {\n    if (!this.isInitializedModule) {\n      throw new Error('Storage module not initialized. Call init() first.');\n    }\n  }\n}\n\nexport const manifest = {\n  name: 'storage',\n  version: '0.1.0',\n  description: 'Enterprise Storage Module - Gestion de fichiers et stockage',\n  author: 'Sky Genesis Enterprise',\n  dependencies: [],\n  exports: {\n    '.': './index.js',\n  },\n  runtime: 'hybrid' as const,\n};\n\nexport default Storage;\n"]}